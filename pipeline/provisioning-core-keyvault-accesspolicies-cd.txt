steps:
- task: ExtractFiles@1
  displayName: 'Extract files: Artifacts'
  inputs:
    archiveFilePatterns: '**\*.zip'
    destinationFolder: '$(System.DefaultWorkingDirectory)\_Extracted\Provisioning'

    steps:
- task: qetza.replacetokens.replacetokens-task.replacetokens@3
  displayName: 'Replace Tokens'
  inputs:
    rootDirectory: '$(System.DefaultWorkingDirectory)\_Extracted\Provisioning'
    targetFiles: '**\Core.KeyVaultsAccessPolicies.ARM.Params.json'
    actionOnMissing: fail
    tokenSuffix: '}'
steps:
- powershell: |
   Get-Content -Path $(System.DefaultWorkingDirectory)\_Extracted\Provisioning\Core\KeyVault\ArmTemplates\Core.KeyVaultsAccessPolicies.ARM.Params.json
   
  displayName: 'View Configuration'

#Your build pipeline references an undefined variable named ‘Core.Infrastructure.ResourceGroupName’. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972

steps:
- task: AzureResourceGroupDeployment@2
  displayName: 'Azure Deployment: key vault access policies'
  inputs:
    azureSubscription: 'NHG Digital NON-PROD (dc8ebcd8-c1cc-43d3-a734-529dc0e858b4)'
    resourceGroupName: '$(Core.Infrastructure.ResourceGroupName)'
    location: 'UK South'
    csmFile: '$(System.DefaultWorkingDirectory)\_Extracted\Provisioning\Core\KeyVault\ArmTemplates\Core.KeyVaultsAccessPolicies.ARM.json'
    csmParametersFile: '$(System.DefaultWorkingDirectory)\_Extracted\Provisioning\Core\KeyVault\ArmTemplates\Core.KeyVaultsAccessPolicies.ARM.Params.json'